import{d as H,K as $,r as s,m as j,o as E,q as G,b as m,c as J,e as K,w as x,g as i,t as f,j as k,s as Y,v as Q,u as X,y as d,aq as ee,N as ae,C as z,J as te}from"./index-fe3c5ff0.js";import{u as se,a as oe}from"./SessionStore-0dc0f2c7.js";const le={class:"mb-4 flex items-center min-h-[28px]"},ne={class:"text-sm font-medium text-gray-900 dark:text-white mr-3 flex-shrink-0"},ie={class:"flex justify-between"},de={class:"mb-4 flex items-center min-h-[28px]"},ce={class:"text-sm font-medium text-gray-900 dark:text-white mr-3 flex-shrink-0"},re={class:"ml-8 mr-8 mb-4 flex w-18 items-center"},ue={class:"gap-3"},me=H({__name:"index",props:{loadedTracks:{type:Array,required:!0}},setup(L){const w=L,N=$();se(),oe();const R=s([]),B=s([]),M=s([]),c=s(!0),r=s([]),S=s(0),C=s(0),h=s(1),v=s(10),P=s([]),u=s(0),_=j(()=>({page:h.value,pageCount:1,pageSize:v.value,itemCount:u.value}));let b=!0;const q=s(""),y=s(""),O=[{title:"Cell Id",key:"cell_id"},{title:"Disease",key:"disease_status"},{title:"BodySites",key:"body_site"},{title:"Assay",key:"assay"},{title:"Format",key:"format"},{title:"Factor",key:"factor"},{title:"Download",key:"download",render:e=>e.loadingStatus==="loading"?d(te):d(ae,{size:"small",onClick:()=>{p.value<5?(e.schedule=!0,p.value++,e.loadingStatus!=="loaded"&&Z(e)):N.warning("Up to 5 files can be downloaded simultaneously.")},disabled:e.loadingStatus==="loaded"},[e.schedule?d(ee,{type:"line",percentage:e.progress}):d("svg",{class:{"w-4":!0,"h-4":!0,"text-gray-800":!0,"dark:text-white":!0},"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[d("path",{d:"M14.707 7.793a1 1 0 0 0-1.414 0L11 10.086V1.5a1 1 0 0 0-2 0v8.586L6.707 7.793a1 1 0 1 0-1.414 1.414l4 4a1 1 0 0 0 1.416 0l4-4a1 1 0 0 0-.002-1.414Z"}),d("path",{d:"M18 12h-2.55l-2.975 2.975a3.5 3.5 0 0 1-4.95 0L4.55 12H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2Zm-3 5a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"})])])}],I=e=>{c.value||(h.value=e,c.value=!0)},V=e=>{},W=s([]),A=s([]),D=j(()=>({diseaseStatus:R.value,bodySites:B.value,assays:M.value,cellId:q.value,format:W.value,factor:A.value,pagesize:v.value,page:h.value,searchTerm:y.value,includeInitialData:b}));console.log(D);const T=e=>{const a={};for(const t in e)if(e.hasOwnProperty(t))if(typeof e[t]=="object"&&e[t]!==null){const l=T(e[t]);for(const o in l)l.hasOwnProperty(o)&&(a[o]=l[o])}else a[t]=e[t];return a},F=e=>{z.get("/api/search/files",{responseType:"json",params:e,paramsSerializer:{indexes:null}}).then(a=>{console.log("data recevied"),c.value=!1,S.value=a.data.from,C.value=a.data.to,u.value=a.data.itemCount,_.value.itemCount=a.data.itemCount,_.value.pageCount=Math.ceil(u.value/v.value),console.log(a.data),r.value=a.data.data.map(T),b&&(P.value=a.data.initial_data,b=!1),r.value.map(t=>{console.log("loadedTracks",w.loadedTracks),console.log("d.id",t.id),t.loadingStatus=w.loadedTracks.includes(t.id)?"loaded":"unloaded",t.schedule=!1,t.progress=0}),console.log(r.value)}).catch(function(a){a.response?(console.log(a.response.data),console.log(a.response.status),console.log(a.response.headers)):a.request?console.log(a.request):console.log("Error",a.message),console.log(a.config)})},U=s(!1),p=s(0),Z=e=>{let a,t,l;switch(e.format){case"bedpe":t="/data/3D_loops",l=e.data_id+"_WashU.bed.gz",a="/data/3D_loops/"+e.data_id+"_WashU.bed.gz";break;case"hic":t="/data/3D_hic",l=e.data_id+".hic",a="/data/3D_hic/"+e.data_id+".hic";break;case"bed":break;case"bigwig":t="/data/3D_bigwig",l=e.data_id+".bigWig",a="/data/3D_bigwig/"+e.data_id+".bigWig";break}U.value=!0,console.log(a),z({method:"get",url:`${t}/${l}`,responseType:"blob",onDownloadProgress:o=>{e.progress=Math.floor(o.loaded*100/o.total),console.log(e.progress),e.progress===100&&(e.schedule=!1,p.value--)}}).then(o=>{const g=window.URL.createObjectURL(new Blob([o.data])),n=document.createElement("a");n.href=g,n.setAttribute("download",l),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n),window.URL.revokeObjectURL(g)}).catch(o=>{console.error("Download error:",o),alert("There was an error downloading the file.")}).finally(()=>{U.value=!1,progress.value=0})};return E(()=>{G(()=>D,e=>{F(e.value)},{immediate:!0,deep:!0})}),(e,a)=>{const t=m("n-data-table"),l=m("n-tab-pane"),o=m("n-tabs"),g=m("n-card");return J(),K(g,{round:"",class:"bg-white col-span-5 lg:col-span-4"},{default:x(()=>[i("div",le,[i("span",ne," You are downloading "+f(p.value)+" files. Up to 5 files can be downloaded simultaneously. ",1)]),k(o,{type:"line"},{default:x(()=>[k(l,{name:"hosted-tracks",tab:"Hosted Tracks"},{default:x(()=>[i("div",ie,[i("div",de,[i("span",ce," Showing "+f(S.value)+" to "+f(C.value)+" cell types of "+f(u.value)+" in total. ",1)]),i("form",re,[Y(i("input",{type:"text",id:"simple-search",class:"relative m-0 block min-w-0 flex-auto rounded-l border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-1.5 text-base font-normal text-neutral-700 outline-none transition duration-300 ease-in-out focus:border-primary focus:text-neutral-700 focus:shadow-te-primary focus:outline-none",placeholder:"Search...",required:"","onUpdate:modelValue":a[0]||(a[0]=n=>y.value=n)},null,512),[[Q,y.value]])])]),i("div",ue,[k(t,{remote:"",bordered:!1,columns:O,loading:c.value,data:r.value,pagination:X(_),"onUpdate:page":I,"onUpdate:sorter":V},null,8,["loading","data","pagination"])])]),_:1})]),_:1})]),_:1})}}});export{me as default};
