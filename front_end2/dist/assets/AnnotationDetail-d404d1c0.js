import{d as O,r as o,o as L,a as P,b as p,c as n,e as _,w as k,g as m,h as N,n as R,_ as B,K as lt,j as S,t as it,u as tt,C as X,D as ct,ao as et,ap as $}from"./index-fe3c5ff0.js";import{d as M,g as j,i as z}from"./index-316b5a0a.js";const ut={class:"chart-item-container"},dt=O({__name:"AnchorStat",props:{inputData:{type:Array,required:!0}},setup(x){const y=x;function v(e,r){let t=j(e);return t||(t=z(e,r)),t}const d=o(!0),c=o(null),A=e=>{const r={color:["#D65F5F","#DF8A8A"],grid:{left:"12%",right:"5%",top:"5%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis"},series:[{name:"访问来源",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!0,length:5,length2:5,smooth:!0},data:e}]};setTimeout(()=>{d.value=!1,R(()=>{v(c.value).setOption(r)})},1e3)};return L(()=>{A(y.inputData)}),P(()=>{M(c.value)}),(e,r)=>{const t=p("n-skeleton"),f=p("n-statistic"),a=p("n-card");return n(),_(a,{"content-style":{padding:"10px"},"header-style":{padding:"10px"},segmented:!0},{header:k(()=>[d.value?(n(),_(t,{key:0,text:"",style:{width:"50%"}})):(n(),_(f,{key:1,label:"Interaction anchors"}))]),default:k(()=>[m("div",ut,[d.value?(n(),_(t,{key:0,text:"",repeat:4})):(n(),N("div",{key:1,ref_key:"channelsChart",ref:c,class:"chart-item"},null,512))])]),_:1})}}});const pt=B(dt,[["__scopeId","data-v-9d38437d"]]),_t={class:"chart-item-container"},ht=O({__name:"InteractionStat",props:{inputData:{type:Array,required:!0}},setup(x){const y=x;function v(e,r){let t=j(e);return t||(t=z(e,r)),t}const d=o(!0),c=o(null),A=()=>{const e={color:["#D65F5F","#DF8A8A","#E8B4B4","#F1DEDE"],grid:{left:"12%",right:"5%",top:"5%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis"},series:[{name:"访问来源",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!0,length:5,length2:5,smooth:!0},data:[{value:78,name:"Cancer "},{value:60,name:"Non-cancer"}]}]};setTimeout(()=>{d.value=!1,R(()=>{v(c.value).setOption(e)})},1e3)};return L(()=>{A(y.inputData)}),P(()=>{M(c.value)}),(e,r)=>{const t=p("n-skeleton"),f=p("n-statistic"),a=p("n-card");return n(),_(a,{"content-style":{padding:"10px"},"header-style":{padding:"10px"},segmented:!0},{header:k(()=>[d.value?(n(),_(t,{key:0,text:"",style:{width:"50%"}})):(n(),_(f,{key:1,label:"Chromatin interactions"}))]),default:k(()=>[m("div",_t,[d.value?(n(),_(t,{key:0,text:"",repeat:4})):(n(),N("div",{key:1,ref_key:"channelsChart",ref:c,class:"chart-item"},null,512))])]),_:1})}}});const mt=B(ht,[["__scopeId","data-v-ede05728"]]),vt={class:"chart-item-container"},yt=O({__name:"NormalAtacStat",props:{inputData:{type:Array,required:!0}},setup(x){const y=x;function v(e,r){let t=j(e);return t||(t=z(e,r)),t}const d=o(!0),c=o(null),A=e=>{const t=[...e].sort((a,l)=>l.value-a.value).slice(0,5).map(a=>a.name);console.log(t);const f={color:["#D65F5F","#DF8A8A"],polar:{},angleAxis:{show:!0,type:"category",data:e.map(a=>a.name),interval:10,boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#999",type:"dashed"}},formatter:(a,l)=>t.includes(e[l].name)?a:"",axisLine:{show:!1}},radiusAxis:{splitLine:{lineStyle:{color:"#999",type:"dashed"}}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},series:[{type:"bar",data:e.map(a=>a.value),coordinateSystem:"polar",name:"Histogram",itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};setTimeout(()=>{d.value=!1,R(()=>{v(c.value).setOption(f)})},1e3)};return L(()=>{console.log(y.inputData),A(y.inputData)}),P(()=>{M(c.value)}),(e,r)=>{const t=p("n-skeleton"),f=p("n-statistic"),a=p("n-card");return n(),_(a,{"content-style":{padding:"10px"},"header-style":{padding:"10px"},segmented:!0},{header:k(()=>[d.value?(n(),_(t,{key:0,text:"",style:{width:"50%"}})):(n(),_(f,{key:1,label:"Normal open chromatin regions"}))]),default:k(()=>[m("div",vt,[d.value?(n(),_(t,{key:0,text:"",repeat:4})):(n(),N("div",{key:1,ref_key:"channelsChart",ref:c,class:"chart-item"},null,512))])]),_:1})}}});const ft=B(yt,[["__scopeId","data-v-a442a672"]]),gt={class:"chart-item-container"},bt=O({__name:"CancerAtacStat",props:{inputData:{type:Array,required:!0}},setup(x){const y=x;function v(e,r){let t=j(e);return t||(t=z(e,r)),t}const d=o(!0),c=o(null),A=e=>{const r={color:["#D65F5F","#DF8A8A"],polar:{},angleAxis:{type:"category",data:e.map(t=>t.name),boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#999",type:"dashed"}},axisLine:{show:!1}},radiusAxis:{splitLine:{lineStyle:{color:"#999",type:"dashed"}}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},series:[{type:"bar",data:e.map(t=>t.value),coordinateSystem:"polar",name:"Histogram",itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};setTimeout(()=>{d.value=!1,R(()=>{v(c.value).setOption(r)})},1e3)};return L(()=>{console.log(y.inputData),A(y.inputData)}),P(()=>{M(c.value)}),(e,r)=>{const t=p("n-skeleton"),f=p("n-statistic"),a=p("n-card");return n(),_(a,{"content-style":{padding:"10px"},"header-style":{padding:"10px"},segmented:!0},{header:k(()=>[d.value?(n(),_(t,{key:0,text:"",style:{width:"50%"}})):(n(),_(f,{key:1,label:"Cancer open chromatin regions"}))]),default:k(()=>[m("div",gt,[d.value?(n(),_(t,{key:0,text:"",repeat:4})):(n(),N("div",{key:1,ref_key:"channelsChart",ref:c,class:"chart-item"},null,512))])]),_:1})}}});const At=B(bt,[["__scopeId","data-v-091d2682"]]),Ct={key:0,class:"flex items-center justify-center w-full"},kt={class:"bg-white flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600"},xt={class:"flex flex-col w-3/5"},wt={key:1},Dt={class:"col-span-2 space-y-8 md:grid md:grid-cols-2 md:gap-12 md:space-y-0"},St={class:"flex justify-between"},Et={class:"mb-4 w-20 mr-3 text-l rounded-l",style:{height:"40px"}},Tt={class:"mt-2"},Ot=O({__name:"AnnotationDetail",props:{taskId:{type:String,required:!0}},setup(x){const y=lt(),v=o("chr1"),c=Object.keys({chrY:59373566,chrX:155270560,chr13:115169878,chr12:133851895,chr11:135006516,chr10:135534747,chr17:81195210,chr16:90354753,chr15:102531392,chr14:107349540,chr19:59128983,chr18:78077248,chrM:16571,chr22:51304566,chr20:63025520,chr21:48129895,chr7:159138663,chr6:171115067,chr5:180915260,chr4:191154276,chr3:198022430,chr2:243199373,chr1:249250621,chr9:141213431,chr8:146364022}).map(s=>({value:s,label:s})),A=({play:s})=>[{title:"chrom1",key:"chrom1"},{title:"start1",key:"start1"},{title:"end1",key:"end1"},{title:"chrom2",key:"chrom2"},{title:"start2",key:"start2"},{title:"end2",key:"end2"},{title:"petCounts",key:"petCounts"},{title:"GenomicAnno1",key:"GenomicAnno1",ellipsis:{tooltip:!0}},{title:"GenomicAnno2",key:"GenomicAnno2",ellipsis:{tooltip:!0}},{title:"ENCODE_ATAC1",key:"ENCODE_ATAC1",ellipsis:{tooltip:!0}},{title:"ENCODE_ATAC2",key:"ENCODE_ATAC2",ellipsis:{tooltip:!0}},{title:"TCGA_ATAC1",key:"TCGA_ATAC1",ellipsis:{tooltip:!0}},{title:"TCGA_ATAC2",key:"TCGA_ATAC2",ellipsis:{tooltip:!0}}],e=o([]),r=A({play(s){y.info(`Play ${s.chrom1}`)}}),t=o("annotation"),f=o(!0),a=o({percent:0,notation:"Start Annotation"}),l=o(null);function w(s){return s.trim().split(`
`).map(E=>{const[C,g]=E.split(":");return{value:g.trim()==="0"?g.trim():parseInt(g.trim(),10),name:C.trim()}})}const q=o([]),V=o([]),W=o([]),H=o([]),at=s=>{X.get(`/api/annotations/task-info/${s}`).then(u=>{(async()=>{if(await u.data.task_status==="SUCCESS"){a.value.percent=95,a.value.notation="Generating summary tables!",l.value=u.data.task_result.notation;const E=l.value.split("=====")[0];E&&(q.value=w(E));const C=l.value.split("=====")[1];C&&(V.value=w(C));const g=l.value.split("=====")[2];g&&(W.value=w(g));const T=l.value.split("=====")[3];T&&(H.value=w(T));const I="/media"+l.value.split("=====")[4].split(" ")[1],G=new et({filehandle:new $(I),tbiFilehandle:new $(`${I}.tbi`)});let F=[];await G.getLines(v.value,0,void 0,function(U,Z){const K=U.split(/;;/),b=K[0].split(/[\s,:-]+/),h=K[1].split(/;/),D={chrom1:b[0],start1:Number(b[1]),end1:Number(b[2]),chrom2:b[3],start2:Number(b[4]),end2:Number(b[5]),petCounts:Number(b[6]),GenomicAnno1:h[0],GenomicAnno2:h[1],ENCODE_ATAC1:h[2],ENCODE_ATAC2:h[3],TCGA_ATAC1:h[4],TCGA_ATAC2:h[5]};F.push(D)}),e.value=F,t.value="COMPLETE"}else await u.data.task_status==="FAILURE"?console.error("Task failed"):await u.data.task_status==="PROGRESS"&&(a.value.percent=u.data.task_result.percent,a.value.notation=u.data.task_result.notation)})()}).catch(u=>{console.error("Error while polling for result:",u)})},Y=o(""),nt=o(""),ot=s=>{const u=setInterval(()=>{X.get(`/api/annotations/task-info/${s}`).then(i=>{(async()=>{if(await i.data.task_status==="SUCCESS"){a.value.percent=95,a.value.notation="Generating summary tables!",l.value=i.data.task_result.notation;const C=l.value.split("=====")[0];C&&(q.value=w(C));const g=l.value.split("=====")[1];g&&(V.value=w(g));const T=l.value.split("=====")[2];T&&(W.value=w(T));const I=l.value.split("=====")[3];I&&(H.value=w(I));const G="/media"+l.value.split("=====")[4].split(" ")[1];nt.value="/media"+l.value.split("=====")[4].split(" ")[0],Y.value="/media"+l.value.split("=====")[4].split(" ")[2];const F=new et({filehandle:new $(G),tbiFilehandle:new $(`${G}.tbi`)});let U=[];await F.getLines(v.value,0,void 0,function(Z,K){const b=Z.split(/;;/),h=b[0].split(/[\s,:-]+/),D=b[1].split(/;/),rt={chrom1:h[0],start1:Number(h[1]),end1:Number(h[2]),chrom2:h[3],start2:Number(h[4]),end2:Number(h[5]),petCounts:Number(h[6]),GenomicAnno1:D[0],GenomicAnno2:D[1],ENCODE_ATAC1:D[2],ENCODE_ATAC2:D[3],TCGA_ATAC1:D[4],TCGA_ATAC2:D[5]};U.push(rt)}),e.value=U,t.value="COMPLETE"}else i.data.task_status==="FAILURE"?console.error("Task failed"):i.data.task_status==="PROGRESS"&&(a.value.percent=i.data.task_result.percent,a.value.notation=i.data.task_result.notation)})()}).catch(i=>{clearInterval(u),console.error("Error while polling for result:",i)})},1e3)},J=ct(),Q=o(0),st=()=>{X({method:"get",url:Y.value,responseType:"blob",onDownloadProgress:s=>{Q.value=Math.floor(s.loaded*100/s.total)}}).then(s=>{const u=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.href=u,document.body.appendChild(i),i.click(),i.parentNode.removeChild(i),window.URL.revokeObjectURL(u)}).catch(s=>{console.error("Download error:",s),alert("There was an error downloading the file.")}).finally(()=>{Q.value=0})};return L(()=>{at(J.params.taskId),t.value!="COMPLETE"&&ot(J.params.taskId)}),(s,u)=>{const i=p("n-progress"),E=p("n-select"),C=p("n-data-table"),g=p("n-card");return t.value!="COMPLETE"?(n(),N("div",Ct,[m("div",kt,[m("div",xt,[S(i,{class:"w-16",type:"line","indicator-placement":"inside",percentage:a.value.percent,processing:"",height:40,"border-radius":8,"fill-border-radius":0},null,8,["percentage"])]),m("div",null,it(a.value.notation),1)])])):(n(),N("div",wt,[m("div",Dt,[S(pt,{inputData:q.value},null,8,["inputData"]),S(mt,{inputData:V.value},null,8,["inputData"]),S(ft,{inputData:W.value},null,8,["inputData"]),S(At,{inputData:H.value},null,8,["inputData"])]),S(g,{bordered:!0,segmented:{content:!0},class:"mb-6 mt-6","header-style":"font-size: 20px;background-color: #D8D8D8;color: #09253D;padding-top: 4px;padding-bottom: 4px;",size:"small",title:"Chromatin interactions"},{default:k(()=>[m("div",St,[m("div",Et,[S(E,{size:"large",value:v.value,"onUpdate:value":u[0]||(u[0]=T=>v.value=T),options:tt(c),"consistent-menu-width":!1},null,8,["value","options"])]),m("div",{class:"mb-4 flex items-center",role:"group"},[m("button",{class:"relative flex items-center mr-3 px-4 py-2.5 text-white rounded-r bg-blue-700 transition duration-150 ease-in-out hover:bg-primary-700 hover:shadow-lg focus:bg-primary-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-primary-800 active:shadow-lg",type:"button",id:"location-search","data-te-ripple-init":"","data-te-ripple-color":"light",onClick:st}," Download annotated dataset ")])]),m("div",Tt,[S(C,{columns:tt(r),data:e.value,pagination:f.value,bordered:!1},null,8,["columns","data","pagination"])])]),_:1})]))}}});export{Ot as default};
